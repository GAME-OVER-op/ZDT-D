<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Управление конфигурациями - Zapret</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Светлая тема */
            --primary: #5e35b1;
            --primary-light: #7e57c2;
            --primary-dark: #4527a0;
            --secondary: #26a69a;
            --success: #43a047;
            --error: #e53935;
            --warning: #ff9800;
            --surface: #ffffff;
            --background: #f5f7fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border: #e0e0e0;
            --shadow: rgba(94, 53, 177, 0.1);
            --nav-bg: #ffffff;
            --card-bg: #ffffff;
            --modal-bg: #ffffff;
            --modal-header-bg: #5e35b1;
            --tab-bg: rgba(94, 53, 177, 0.05);
            --action-btn-bg: transparent;
        }

        [data-theme="dark"] {
            /* Темная тема */
            --primary: #7e57c2;
            --primary-light: #9575cd;
            --primary-dark: #654ea3;
            --secondary: #26a69a;
            --success: #66bb6a;
            --error: #ef5350;
            --warning: #ffa726;
            --surface: #1e1e1e;
            --background: #121212;
            --text-primary: #e0e0e0;
            --text-secondary: #9e9e9e;
            --border: #333333;
            --shadow: rgba(0, 0, 0, 0.2);
            --nav-bg: #1e1e1e;
            --card-bg: #1e1e1e;
            --modal-bg: #1e1e1e;
            --modal-header-bg: #7e57c2;
            --tab-bg: rgba(126, 87, 194, 0.15);
            --action-btn-bg: rgba(255, 255, 255, 0.05);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        body {
            background: var(--background);
            min-height: 100vh;
            font-family: 'Roboto', sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        header {
            text-align: center;
            padding: 20px 20px 10px;
            position: relative;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            box-shadow: 0 4px 12px rgba(94, 53, 177, 0.25);
        }
        
        .logo i {
            font-size: 34px;
            color: white;
            position: relative;
        }
        
        h1 {
            font-size: 1.6rem;
            color: var(--primary-light);
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }
        
        nav {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: var(--nav-bg);
            border-radius: 15px;
            box-shadow: 0 4px 12px var(--shadow);
            overflow: hidden;
            flex-wrap: nowrap;
            overflow-x: auto;
            border: 1px solid var(--border);
        }
        
        .nav-item {
            flex: 1 0 auto;
            min-width: 100px;
            text-align: center;
            padding: 12px 8px;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .nav-item i {
            margin-bottom: 4px;
            font-size: 18px;
            transition: color 0.3s ease;
        }
        
        .nav-item.active, .nav-item:hover {
            background: var(--primary);
            color: white;
        }
        
        .nav-item.active i, .nav-item:hover i {
            color: white;
        }
        
        .config-manager {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid var(--border);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--tab-bg);
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            color: var(--text-secondary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: rgba(94, 53, 177, 0.05);
        }
        
        .tab-content {
            padding: 20px;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-light);
            margin: 20px 0 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .config-files {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .file-card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow);
        }
        
        .file-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            background: rgba(94, 53, 177, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .file-icon i {
            color: var(--primary);
            font-size: 20px;
        }
        
        .file-info {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-path {
            font-size: 0.8rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--action-btn-bg);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: rgba(94, 53, 177, 0.1);
            border-color: var(--primary-light);
        }
        
        .action-btn.edit:hover {
            background: rgba(33, 150, 243, 0.1);
            border-color: #2196f3;
        }
        
        .action-btn.delete:hover {
            background: rgba(229, 57, 53, 0.1);
            border-color: var(--error);
        }
        
        .action-btn i {
            font-size: 18px;
            color: var(--text-secondary);
        }
        
        .action-btn.edit:hover i {
            color: #2196f3;
        }
        
        .action-btn.delete:hover i {
            color: var(--error);
        }
        
        .file-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
            flex-grow: 1;
        }
        
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--modal-bg);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: modalIn 0.3s ease-out;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        
        .modal-header {
            background: var(--modal-header-bg);
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-weight: 500;
            font-size: 1.3rem;
        }
        
        .close-modal {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.2s ease;
            font-family: monospace;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 2px rgba(94, 53, 177, 0.1);
        }
        
        textarea.form-control {
            min-height: 300px;
            resize: vertical;
        }
        
        .modal-footer {
            padding: 15px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid var(--border);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 6px rgba(94, 53, 177, 0.3);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(94, 53, 177, 0.4);
        }
        
        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--tab-bg);
        }
        
        .loading-indicator {
            text-align: center;
            padding: 30px;
        }
        
        .loading-indicator i {
            font-size: 40px;
            color: var(--primary);
            animation: spin 1.5s linear infinite;
        }
        
        @keyframes modalIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-light);
            color: white;
            border-radius: 20px;
            padding: 3px 10px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .interface-select {
            margin-top: 10px;
        }
        
        .interface-select label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .interface-select select {
            width: 100%;
            padding: 8px 12px;
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        /* DNS Crypt Styles */
        .dnscrypt-servers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .server-tag {
            background: rgba(94, 53, 177, 0.1);
            border: 1px solid var(--primary-light);
            border-radius: 20px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .server-tag:hover {
            background: rgba(94, 53, 177, 0.2);
        }
        
        .server-tag.active {
            background: var(--primary);
            color: white;
        }
        
        .server-tag .delete {
            color: var(--error);
            font-size: 18px;
        }
        
        .server-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .server-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        .cloaking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .cloaking-table th,
        .cloaking-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .cloaking-table th {
            background: var(--tab-bg);
            color: var(--primary);
            font-weight: 500;
        }
        
        .cloaking-table tr:hover {
            background: rgba(94, 53, 177, 0.05);
        }
        
        .action-cell {
            display: flex;
            gap: 10px;
        }
        
        .table-action {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 5px;
        }
        
        .table-action:hover {
            color: var(--primary);
        }
        
        .add-rule-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .add-rule-form {
                grid-template-columns: 1fr;
            }
            
            .config-files {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .file-header {
                flex-wrap: wrap;
            }
            
            .file-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
        }
        
        @media (max-width: 480px) {
            .modal-footer {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .nav-item span {
                font-size: 0.8rem;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
    <script type="module">
        import { exec, toast } from '/kernelsu.js';
        
        const WORKING_DIR = '/data/adb/modules/ZDT-D/working_folder/';
        const DNSCRYPT_DIR = '/data/adb/modules/ZDT-D/dnscrypt-proxy/';
        
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else if (systemPrefersDark) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }
        
        async function readFileContent(fileName) {
            try {
                const { stdout } = await exec(`cat "${WORKING_DIR}${fileName}"`);
                return stdout;
            } catch (error) {
                console.error('Ошибка чтения файла:', error);
                return '';
            }
        }
        
        async function writeFileContent(fileName, content) {
            try {
                const escapedContent = content
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\$/g, '\\$')
                    .replace(/`/g, '\\`');
                
                await exec(`echo "${escapedContent}" > "${WORKING_DIR}${fileName}"`);
                return true;
            } catch (error) {
                console.error('Ошибка записи файла:', error);
                return false;
            }
        }
        
        async function readFileContentAbsolute(filePath) {
            try {
                const { stdout } = await exec(`cat "${filePath}"`);
                return stdout;
            } catch (error) {
                console.error('Ошибка чтения файла:', error);
                return '';
            }
        }
        
        async function writeFileContentAbsolute(filePath, content) {
            try {
                const escapedContent = content
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\$/g, '\\$')
                    .replace(/`/g, '\\`');
                
                await exec(`echo "${escapedContent}" > "${filePath}"`);
                return true;
            } catch (error) {
                console.error('Ошибка записи файла:', error);
                return false;
            }
        }
        
        async function openEditModal(fileName) {
            try {
                document.getElementById('editLoading').style.display = 'block';
                document.getElementById('editForm').style.display = 'none';
                document.getElementById('editFileModal').style.display = 'flex';
                
                const content = await readFileContent(fileName);
                document.getElementById('editFileName').value = fileName;
                document.getElementById('fileContent').value = content;
                
                document.getElementById('editLoading').style.display = 'none';
                document.getElementById('editForm').style.display = 'block';
            } catch (error) {
                console.error('Ошибка открытия файла для редактирования:', error);
                alert('Не удалось загрузить содержимое файла');
                closeEditModal();
            }
        }
        
        async function saveFile() {
            const fileName = document.getElementById('editFileName').value;
            const content = document.getElementById('fileContent').value;
            
            try {
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="material-icons">sync</i> Сохранение...';
                
                const success = await writeFileContent(fileName, content);
                
                if (success) {
                    closeEditModal();
                    toast('Изменения успешно сохранены');
                } else {
                    toast('Ошибка при сохранении файла');
                }
            } catch (error) {
                console.error('Ошибка сохранения файла:', error);
                toast('Не удалось сохранить файл');
            } finally {
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="material-icons">save</i> Сохранить';
            }
        }
        
        async function getNetworkInterfaces() {
            try {
                const { stdout } = await exec('ip link show');
                const interfaces = [];
                const lines = stdout.split('\n');
                
                lines.forEach(line => {
                    const match = line.match(/^\d+: ([^:]+):/);
                    if (match) {
                        interfaces.push(match[1]);
                    }
                });
                
                return interfaces;
            } catch (error) {
                console.error('Ошибка получения интерфейсов:', error);
                return [];
            }
        }
        
        async function saveInterfaceSetting(zapretNum, type, interfaceName) {
            const cleanInterface = interfaceName.split('@')[0];
            const fileName = `zapret_params_${type}${zapretNum}`;
            try {
                await writeFileContent(fileName, cleanInterface);
                toast(`Интерфейс ${cleanInterface} сохранен для ${type === 'mobile' ? 'мобильного интернета' : 'Wi-Fi'}`);
            } catch (error) {
                console.error('Ошибка сохранения интерфейса:', error);
                toast('Ошибка сохранения интерфейса');
            }
        }
        
        function findMatchingInterface(savedValue, interfaces) {
            const exactMatch = interfaces.find(iface => iface === savedValue);
            if (exactMatch) return exactMatch;
            
            const baseMatch = interfaces.find(iface => {
                const baseName = iface.split('@')[0];
                return baseName === savedValue;
            });
            
            return baseMatch || '';
        }
        
        async function initInterfaceSelectors() {
            const interfaces = await getNetworkInterfaces();
            
            for (let i = 0; i <= 5; i++) {
                const mobileSelect = document.getElementById(`mobile_interface_${i}`);
                if (mobileSelect) {
                    mobileSelect.innerHTML = '';
                    interfaces.forEach(iface => {
                        const option = document.createElement('option');
                        option.value = iface;
                        option.textContent = iface;
                        mobileSelect.appendChild(option);
                    });
                    
                    try {
                        const savedValue = (await readFileContent(`zapret_params_mobile${i}`)).trim();
                        if (savedValue) {
                            const matchedInterface = findMatchingInterface(savedValue, interfaces);
                            if (matchedInterface) {
                                mobileSelect.value = matchedInterface;
                            }
                        }
                    } catch (e) {}
                    
                    mobileSelect.addEventListener('change', () => {
                        saveInterfaceSetting(i, 'mobile', mobileSelect.value);
                    });
                }
                
                const wifiSelect = document.getElementById(`wifi_interface_${i}`);
                if (wifiSelect) {
                    wifiSelect.innerHTML = '';
                    interfaces.forEach(iface => {
                        const option = document.createElement('option');
                        option.value = iface;
                        option.textContent = iface;
                        wifiSelect.appendChild(option);
                    });
                    
                    try {
                        const savedValue = (await readFileContent(`zapret_params_wifi${i}`)).trim();
                        if (savedValue) {
                            const matchedInterface = findMatchingInterface(savedValue, interfaces);
                            if (matchedInterface) {
                                wifiSelect.value = matchedInterface;
                            }
                        }
                    } catch (e) {}
                    
                    wifiSelect.addEventListener('change', () => {
                        saveInterfaceSetting(i, 'wifi', wifiSelect.value);
                    });
                }
            }
        }
        
        function closeEditModal() {
            document.getElementById('editFileModal').style.display = 'none';
        }
        
        // DNS Crypt Functions
        function parseServersFromToml(tomlContent) {
            const serverRegex = /server_names\s*=\s*\[([\s\S]*?)\]/;
            const match = tomlContent.match(serverRegex);
            if (match && match[1]) {
                const content = match[1].trim();
                return content
                    .split(',')
                    .map(s => s.trim().replace(/['"]/g, ''))
                    .filter(s => s);
            }
            return [];
        }

        function updateTomlServers(tomlContent, servers) {
            const serverRegex = /(server_names\s*=\s*\[)[\s\S]*?(\])/;
            const newServerList = `'${servers.join("', '")}'`;
            return tomlContent.replace(serverRegex, `$1${newServerList}$2`);
        }

        async function loadCloakingRules() {
            try {
                const { stdout } = await exec(`cat "${DNSCRYPT_DIR}cloaking-rules.txt"`);
                const rules = [];
                const lines = stdout.split('\n');
                
                lines.forEach(line => {
                    if (line.trim() && !line.startsWith('#')) {
                        const [domain, ip] = line.split(/\s+/);
                        if (domain && ip) {
                            rules.push({ domain, ip });
                        }
                    }
                });
                
                return rules;
            } catch (error) {
                console.error('Ошибка чтения cloaking-rules:', error);
                return [];
            }
        }

        async function saveCloakingRules(rules) {
            const content = rules.map(rule => `${rule.domain} ${rule.ip}`).join('\n');
            try {
                const escapedContent = content
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\$/g, '\\$')
                    .replace(/`/g, '\\`');
                
                await exec(`echo "${escapedContent}" > "${DNSCRYPT_DIR}cloaking-rules.txt"`);
                return true;
            } catch (error) {
                console.error('Ошибка записи cloaking-rules:', error);
                return false;
            }
        }

        function renderCloakingRules(rules) {
            const table = document.getElementById('cloakingRulesTable');
            if (!table) return;
            
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            
            rules.forEach((rule, index) => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${rule.domain}</td>
                    <td>${rule.ip}</td>
                    <td class="action-cell">
                        <button class="table-action edit-rule" data-index="${index}">
                            <i class="material-icons">edit</i>
                        </button>
                        <button class="table-action delete-rule" data-index="${index}">
                            <i class="material-icons">delete</i>
                        </button>
                    </td>
                `;
            });
            
            document.querySelectorAll('.edit-rule').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.dataset.index);
                    const rule = rules[index];
                    document.getElementById('editDomain').value = rule.domain;
                    document.getElementById('editIp').value = rule.ip;
                    document.getElementById('editIndex').value = index;
                    document.getElementById('editRuleModal').style.display = 'flex';
                });
            });
            
            document.querySelectorAll('.delete-rule').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const index = parseInt(btn.dataset.index);
                    if (confirm('Удалить это правило?')) {
                        rules.splice(index, 1);
                        await saveCloakingRules(rules);
                        renderCloakingRules(rules);
                        toast('Правило удалено');
                    }
                });
            });
        }

        async function initDnscrypt() {
            try {
                // Функция для загрузки и отображения серверов
                async function loadAndRenderServers() {
                    const tomlContent = await readFileContentAbsolute(DNSCRYPT_DIR + 'dnscrypt-proxy.toml');
                    const servers = parseServersFromToml(tomlContent);
                    renderServers(servers);
                    return servers;
                }
                
                // Загрузка серверов
                await loadAndRenderServers();
                
                // Обработчик кнопки добавления сервера
                document.getElementById('addServerBtn').addEventListener('click', async () => {
                    const serverInput = document.getElementById('serverInput');
                    const serverName = serverInput.value.trim();
                    
                    if (serverName) {
                        const tomlContent = await readFileContentAbsolute(DNSCRYPT_DIR + 'dnscrypt-proxy.toml');
                        let servers = parseServersFromToml(tomlContent);
                        servers.push(serverName);
                        const newTomlContent = updateTomlServers(tomlContent, servers);
                        await writeFileContentAbsolute(DNSCRYPT_DIR + 'dnscrypt-proxy.toml', newTomlContent);
                        renderServers(servers);
                        serverInput.value = '';
                        toast('Сервер добавлен');
                    }
                });
                
                // Загрузка правил клоакинга
                const rules = await loadCloakingRules();
                renderCloakingRules(rules);
                
                document.getElementById('addRuleBtn').addEventListener('click', async () => {
                    const domainInput = document.getElementById('domainInput');
                    const ipInput = document.getElementById('ipInput');
                    
                    const domain = domainInput.value.trim();
                    const ip = ipInput.value.trim();
                    
                    if (domain && ip) {
                        rules.push({ domain, ip });
                        await saveCloakingRules(rules);
                        renderCloakingRules(rules);
                        domainInput.value = '';
                        ipInput.value = '';
                        toast('Правило добавлено');
                    }
                });
            } catch (error) {
                console.error('Ошибка инициализации Dnscrypt:', error);
            }
        }

        function renderServers(servers) {
            const container = document.getElementById('dnscryptServers');
            if (!container) return;
            
            container.innerHTML = '';
            
            servers.forEach(server => {
                const tag = document.createElement('div');
                tag.className = 'server-tag';
                tag.innerHTML = `
                    ${server}
                    <span class="delete" data-server="${server}">
                        <i class="material-icons">close</i>
                    </span>
                `;
                container.appendChild(tag);
                
                tag.querySelector('.delete').addEventListener('click', async (e) => {
                    e.stopPropagation();
                    if (confirm('Удалить этот DNS сервер?')) {
                        const tomlContent = await readFileContentAbsolute(DNSCRYPT_DIR + 'dnscrypt-proxy.toml');
                        let currentServers = parseServersFromToml(tomlContent);
                        const serverName = e.currentTarget.dataset.server;
                        const index = currentServers.indexOf(serverName);
                        if (index !== -1) {
                            currentServers.splice(index, 1);
                            const newTomlContent = updateTomlServers(tomlContent, currentServers);
                            await writeFileContentAbsolute(DNSCRYPT_DIR + 'dnscrypt-proxy.toml', newTomlContent);
                            renderServers(currentServers);
                            toast('Сервер удален');
                        }
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            initTheme();
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                    
                    if (tab.dataset.tab === 'dnscrypt') {
                        initDnscrypt();
                    }
                });
            });
            
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', () => {
                    const fileName = btn.dataset.file;
                    openEditModal(fileName);
                });
            });
            
            document.getElementById('closeEditModal').addEventListener('click', closeEditModal);
            document.getElementById('cancelEditBtn').addEventListener('click', closeEditModal);
            document.getElementById('saveBtn').addEventListener('click', saveFile);
            
            document.getElementById('editFileModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('editFileModal')) {
                    closeEditModal();
                }
            });
            
            document.getElementById('fileContent').addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    saveFile();
                }
            });
            
            // DNS Crypt modal handlers
            document.getElementById('closeEditRuleModal').addEventListener('click', () => {
                document.getElementById('editRuleModal').style.display = 'none';
            });
            
            document.getElementById('cancelEditRuleBtn').addEventListener('click', () => {
                document.getElementById('editRuleModal').style.display = 'none';
            });
            
            document.getElementById('saveRuleBtn').addEventListener('click', async () => {
                const index = document.getElementById('editIndex').value;
                const domain = document.getElementById('editDomain').value.trim();
                const ip = document.getElementById('editIp').value.trim();
                
                if (domain && ip) {
                    const rules = await loadCloakingRules();
                    rules[index] = { domain, ip };
                    await saveCloakingRules(rules);
                    renderCloakingRules(rules);
                    document.getElementById('editRuleModal').style.display = 'none';
                    toast('Правило обновлено');
                }
            });
            
            await initInterfaceSelectors();
            
            // Initialize Dnscrypt if tab is active
            if (document.querySelector('.tab.active[data-tab="dnscrypt"]')) {
                initDnscrypt();
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="material-icons">tune</i>
            </div>
            <h1>Управление конфигурациями</h1>
            <div class="subtitle">Рабочая директория: /data/adb/modules/ZDT-D/working_folder/</div>
        </header>
        
        <nav>
            <a href="index.html" class="nav-item">
                <i class="material-icons">info</i>
                <span>Инфо</span>
            </a>
            <a href="domains.html" class="nav-item">
                <i class="material-icons">domain</i>
                <span>Домены</span>
            </a>
            <a href="#" class="nav-item active">
                <i class="material-icons">build</i>
                <span>Конфиг</span>
            </a>
            <a href="check.html" class="nav-item">
                <i class="material-icons">monitoring</i>
                <span>Мониторинг</span>
            </a>
            <a href="backup.html" class="nav-item">
                <i class="material-icons">backup</i>
                <span>Бэкап</span>
            </a>
        </nav>
        
        <div class="config-manager">
            <div class="tabs">
                <div class="tab active" data-tab="dpi">DPI Tunnel</div>
                <div class="tab" data-tab="zapret">Zapret</div>
                <div class="tab" data-tab="byedpi">ByeDPI</div>
                <div class="tab" data-tab="dnscrypt">Dnscrypt</div>
            </div>
            
            <!-- DPI Tunnel Tab -->
            <div class="tab-content active" id="dpi-tab">
                <div class="section-title">
                    <i class="material-icons">security</i>
                    <span>DPI Tunnel 0</span>
                </div>
                <div class="config-files">
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">code</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">config0</div>
                                <div class="file-path">config0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="config0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основной конфигурационный файл для DPI Tunnel 0</p>
                    </div>
                    
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">uid_program0</div>
                                <div class="file-path">uid_program0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="uid_program0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Список приложений для DPI Tunnel 0</p>
                    </div>
                </div>
                
                <div class="section-title">
                    <i class="material-icons">security</i>
                    <span>DPI Tunnel 1</span>
                </div>
                <div class="config-files">
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">code</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">config1</div>
                                <div class="file-path">config1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="config1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основной конфигурационный файл для DPI Tunnel 1</p>
                    </div>
                    
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">uid_program1</div>
                                <div class="file-path">uid_program1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="uid_program1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Список приложений для DPI Tunnel 1</p>
                    </div>
                </div>
            </div>
            
            <!-- Zapret Tab -->
            <div class="tab-content" id="zapret-tab">
                <!-- Zapret 0 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 0</span>
                </div>
                <div class="config-files">
                    <!-- Конфигурация -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 0</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Конфигурация</div>
                                <div class="file-path">zapret_config0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_config0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основные настройки для Zapret 0</p>
                    </div>
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 0</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 0</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 0</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_0">Интерфейс:</label>
                            <select id="mobile_interface_0" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 0</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi0</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi0">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_0">Интерфейс:</label>
                            <select id="wifi_interface_0" class="form-control"></select>
                        </div>
                    </div>
                </div>
                
                <!-- Zapret 1 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 1</span>
                </div>
                <div class="config-files">
                    <!-- Конфигурация -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 1</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Конфигурация</div>
                                <div class="file-path">zapret_config1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_config1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основные настройки для Zapret 1</p>
                    </div>
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 1</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 1</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 1</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_1">Интерфейс:</label>
                            <select id="mobile_interface_1" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 1</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi1</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi1">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_1">Интерфейс:</label>
                            <select id="wifi_interface_1" class="form-control"></select>
                        </div>
                    </div>
                </div>
                
                <!-- Zapret 2 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 2</span>
                </div>
                <div class="config-files">
                    <!-- Конфигурация -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 2</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Конфигурация</div>
                                <div class="file-path">zapret_config2</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_config2">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основные настройки для Zapret 2</p>
                    </div>
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 2</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid2</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid2">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 2</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 2</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile2</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile2">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_2">Интерфейс:</label>
                            <select id="mobile_interface_2" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 2</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi2</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi2">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_2">Интерфейс:</label>
                            <select id="wifi_interface_2" class="form-control"></select>
                        </div>
                    </div>
                </div>
                
                <!-- Zapret 3 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 3</span>
                </div>
                <div class="config-files">
                    <!-- Конфигурация -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 3</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Конфигурация</div>
                                <div class="file-path">zapret_config3</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_config3">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основные настройки для Zapret 3</p>
                    </div>
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 3</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid3</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid3">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 3</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 3</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile3</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile3">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_3">Интерфейс:</label>
                            <select id="mobile_interface_3" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 3</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi3</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi3">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_3">Интерфейс:</label>
                            <select id="wifi_interface_3" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- IP-диапазоны -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 3</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">dns</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">IP-диапазоны</div>
                                <div class="file-path">ip_ranges3.txt</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="ip_ranges3.txt">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>IP-диапазоны для Zapret 3</p>
                    </div>
                </div>
                
                <!-- Zapret 4 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 4</span>
                </div>
                <div class="config-files">
                    <!-- Конфигурация -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 4</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Конфигурация</div>
                                <div class="file-path">zapret_config4</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_config4">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основные настройки для Zapret 4</p>
                    </div>
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 4</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid4</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid4">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 4</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 4</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile4</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile4">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_4">Интерфейс:</label>
                            <select id="mobile_interface_4" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 4</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi4</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi4">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_4">Интерфейс:</label>
                            <select id="wifi_interface_4" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- IP-диапазоны -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 4</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">dns</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">IP-диапазоны</div>
                                <div class="file-path">ip_ranges4.txt</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="ip_ranges4.txt">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>IP-диапазоны для Zapret 4</p>
                    </div>
                </div>
                
                <!-- Zapret 5 -->
                <div class="section-title">
                    <i class="material-icons">filter_alt</i>
                    <span>Настройки Zapret 5</span>
                </div>
                <div class="config-files">
                    
                    <!-- Общий список приложений -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 5</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Список приложений</div>
                                <div class="file-path">zapret_uid5</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_uid5">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Общий список приложений для Zapret 5</p>
                    </div>
                    
                    <!-- Мобильный интернет -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 5</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">sim_card</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Мобильный интернет</div>
                                <div class="file-path">zapret_mobile5</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_mobile5">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="mobile_interface_5">Интерфейс:</label>
                            <select id="mobile_interface_5" class="form-control"></select>
                        </div>
                    </div>
                    
                    <!-- Wi-Fi -->
                    <div class="file-card">
                        <div class="info-badge">Zapret 5</div>
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">wifi</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">Wi-Fi</div>
                                <div class="file-path">zapret_wifi5</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="zapret_wifi5">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <div class="interface-select">
                            <label for="wifi_interface_5">Интерфейс:</label>
                            <select id="wifi_interface_5" class="form-control"></select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ByeDPI Tab -->
            <div class="tab-content" id="byedpi-tab">
                <div class="section-title">
                    <i class="material-icons">vpn_key</i>
                    <span>ByeDPI</span>
                </div>
                <div class="config-files">
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">settings</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">ciadpi.conf</div>
                                <div class="file-path">ciadpi.conf</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="ciadpi.conf">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Основной конфигурационный файл для ByeDPI</p>
                    </div>
                    
                    <div class="file-card">
                        <div class="file-header">
                            <div class="file-icon">
                                <i class="material-icons">apps</i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">bye_dpi</div>
                                <div class="file-path">bye_dpi</div>
                            </div>
                            <div class="file-actions">
                                <button class="action-btn edit" title="Редактировать" data-file="bye_dpi">
                                    <i class="material-icons">edit</i>
                                </button>
                            </div>
                        </div>
                        <p>Список приложений для ByeDPI</p>
                    </div>
                </div>
            </div>
            
            <!-- Dnscrypt Tab -->
            <div class="tab-content" id="dnscrypt-tab">
                <div class="section-title">
                    <i class="material-icons">dns</i>
                    <span>Dnscrypt Proxy</span>
                </div>
                
                <div class="file-card">
                    <div class="file-header">
                        <div class="file-icon">
                            <i class="material-icons">dns</i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">DNS Серверы</div>
                            <div class="file-path">dnscrypt-proxy.toml</div>
                        </div>
                    </div>
                    <p>Выберите DNS серверы для использования:</p>
                    
                    <div id="dnscryptServers" class="dnscrypt-servers"></div>
                    
                    <div class="server-form">
                        <input type="text" id="serverInput" class="server-input" placeholder="Название DNS сервера">
                        <button id="addServerBtn" class="btn btn-primary">
                            <i class="material-icons">add</i> Добавить
                        </button>
                    </div>
                </div>
                
                <div class="file-card">
                    <div class="file-header">
                        <div class="file-icon">
                            <i class="material-icons">swap_horiz</i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">Правила клоакинга</div>
                            <div class="file-path">cloaking-rules.txt</div>
                        </div>
                    </div>
                    <p>Настройка DNS обхода для доменов:</p>
                    
                    <table class="cloaking-table">
                        <thead>
                            <tr>
                                <th>Домен</th>
                                <th>IP адрес</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="cloakingRulesTable">
                            <!-- Правила будут добавляться динамически -->
                        </tbody>
                    </table>
                    
                    <div class="add-rule-form">
                        <input type="text" id="domainInput" class="form-control" placeholder="Домен (например: example.com)">
                        <input type="text" id="ipInput" class="form-control" placeholder="IP адрес (например: 1.2.3.4)">
                        <button id="addRuleBtn" class="btn btn-primary">
                            <i class="material-icons">add</i> Добавить правило
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно для редактирования файла -->
    <div id="editFileModal" class="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Редактирование файла</h3>
                <button id="closeEditModal" class="close-modal">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <div id="editLoading" class="loading-indicator">
                    <i class="material-icons">sync</i>
                    <p>Загрузка содержимого...</p>
                </div>
                <div id="editForm" style="display: none;">
                    <div class="form-group">
                        <label for="editFileName">Имя файла</label>
                        <input type="text" id="editFileName" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileContent">Содержимое файла</label>
                        <textarea id="fileContent" class="form-control" rows="15"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelEditBtn" class="btn btn-secondary">
                    <i class="material-icons">close</i> Отмена
                </button>
                <button id="saveBtn" class="btn btn-primary">
                    <i class="material-icons">save</i> Сохранить
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно для редактирования правила клоакинга -->
    <div id="editRuleModal" class="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Редактирование правила</h3>
                <button id="closeEditRuleModal" class="close-modal">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editDomain">Домен</label>
                    <input type="text" id="editDomain" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editIp">IP адрес</label>
                    <input type="text" id="editIp" class="form-control">
                </div>
                <input type="hidden" id="editIndex">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditRuleBtn">
                    <i class="material-icons">close</i> Отмена
                </button>
                <button id="saveRuleBtn" class="btn btn-primary">
                    <i class="material-icons">save</i> Сохранить
                </button>
            </div>
        </div>
    </div>
</body>
</html>